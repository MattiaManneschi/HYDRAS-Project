# HYDRAS Source Seeking - Configuration
# Basato sulle specifiche del report DICEA per le simulazioni nel porto di Cecina

# Domain configuration (from report)
domain:
  # Coordinate box di estrazione (UTM 32)
  xmin: 619000  # m
  xmax: 622000  # m
  ymin: 4794500  # m
  ymax: 4797000  # m
  
  # Grid resolution
  grid_resolution: 10  # m (come da report)
  
  # Derived dimensions
  nx: 300  # (622000 - 619000) / 10
  ny: 250  # (4797000 - 4794500) / 10

# Source configuration (from report)
sources:
  S1:
    x: 620100  # m UTM
    y: 4796210  # m UTM
  S2:
    x: 619800
    y: 4795900
  S3:
    x: 620200
    y: 4795800
  
  # Emission parameters
  flow_rate: 50  # l/s
  concentration: 1000  # g/m³

# Agent configuration
agent:
  # Observation space
  sensor_radius: 50  # m - raggio di percezione
  n_concentration_samples: 8  # punti campionati attorno all'agente
  
  # Action space
  max_velocity: 1.5  # m/s - velocità massima dell'AUV
  action_type: "continuous"  # "continuous" o "discrete"
  n_discrete_actions: 8  # solo se action_type = "discrete"
  
  # Physical constraints
  min_depth: 2.0  # m - profondità minima operativa
  max_depth: 50.0  # m - profondità massima
  
  # Initial position
  spawn_mode: "far_from_source"  # Hard evaluation: spawn lontano dalla sorgente
  spawn_margin: 100  # m dal bordo se random

# Environment configuration
environment:
  # Time settings
  dt: 10  # s - timestep della simulazione
  max_episode_steps: 500  # passi massimi per episodio

  # Reward shaping
  reward:
    source_reached_bonus: 100.0
    concentration_gradient_scale: 10.0
    step_penalty: -0.1
    boundary_penalty: -10.0
    source_threshold: 0.8  # frazione della concentrazione max per "trovato"
    distance_threshold: 100  # m - distanza dalla sorgente per "trovato"
    auto_detect_source: true  # USA LA SORGENTE RILEVATA DAL MAX CONCENTRAZIONE

  # Normalization
  normalize_obs: true
  normalize_reward: false

# Training configuration (PPO)
training:
  # Algorithm
  algorithm: "PPO"

  # Hyperparameters
  learning_rate: 0.0003
  n_steps: 2048
  batch_size: 64
  n_epochs: 10
  gamma: 0.99
  gae_lambda: 0.95
  clip_range: 0.2
  ent_coef: 0.01  # RIDOTTO: meno esplorazione casuale, più sfruttamento
  vf_coef: 0.5
  max_grad_norm: 0.5

  # Network architecture
  policy: "MlpPolicy"
  policy_kwargs:
    net_arch:
      pi: [256, 256]
      vf: [256, 256]
    activation_fn: "tanh"

  # Training loop
  total_timesteps: 1000000
  eval_freq: 10000
  n_eval_episodes: 10
  save_freq: 50000

  # Logging
  tensorboard_log: "./logs/tensorboard"
  verbose: 1

# Data configuration
data:
  # NetCDF file pattern
  nc_pattern: "CMEMS_*_conc_grid_10m.nc"

  # Variables to load (from MIKE21 output)
  concentration_var: "Concentration - component 1"  # nome esatto nel NC
  time_var: "time"
  x_var: "x"
  y_var: "y"

  # Grid info (from NC inspection)
  # time: 2821 steps (~47 ore con dt=1min)
  # y: 251 cells
  # x: 301 cells

  # Preprocessing
  interpolation: "linear"
  fill_value: 0.0

# Synthetic data (for testing without NC files)
synthetic:
  enabled: true  # usa dati sintetici se NC non disponibile
  plume_model: "gaussian"  # "gaussian", "advection_diffusion"

  # Gaussian plume parameters
  gaussian:
    diffusion_coef: 5.0  # m²/s
    advection_velocity: [0.1, 0.05]  # m/s [u, v]
    source_strength: 1000  # g/m³

  # Time-varying parameters
  time_varying: true
  wind_variability: 0.2  # coefficiente di variabilità

# Multi-agent configuration (for future extension)
multi_agent:
  enabled: false
  n_agents: 3
  communication_range: 100  # m
  shared_reward: false
  coordination_bonus: 5.0